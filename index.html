<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Raspberry Pi 3 Server</title>
<style>
    body {
        width: 50em;
        margin: 0 auto;
    }
</style>
</head>
<body>
<h1>Raspberry Pi 3 Server</h1>
<div>
    <p>Raspberry Pi 3 で主にファイルサーバを運用中．</p>
    <a href="//git.noyuno.mydns.jp">Git</a>
    <a href="//kanban.noyuno.mydns.jp">Kanban</a>
    <a href="//status.noyuno.mydns.jp">Status</a>
</div>
<div>
    <div style="background-color: black; float:left">
        <img id="chromecast_fig"></img>
    </div>
    <div>
        Chromecast: 
        <button id="play">再生</button>
        <button id="pause">一時停止</button>
        <div id="chromecast"></div>
    </div>
</div>
<canvas id="myChart"></canvas>

<hr>
<address><a href="//noyuno.github.io">noyuno</a></address>

<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.min.js"></script>
<script>
var disk = function () {
    var ctx = document.getElementById("myChart").getContext('2d');
    var r = new XMLHttpRequest();
    r.onload = function () {
        var d = JSON.parse(r.responseText);
        var myChart = new Chart(ctx, {
            type: 'pie', 
            data: {
                labels: ["used", "free"], 
                datasets: [{
                    data: [d.used, d.free],
                    backgroundColor: [
                        "#2ecc71",
                        "#3498db",
                        "#95a5a6",
                        "#9b59b6",
                        "#f1c40f",
                        "#e74c3c",
                        "#34495e"
                    ],
                }]
            }, 
            options: {
                title: {
                    display: true,
                    text: "disk usage [GiB]"
                }
            }
            });
    };
    r.onerror = function () {
        console.log("error");
    };

    r.open('GET', "/disk.php", true);
    r.send(null);

};
var chromecast = function () {
    var t = $("#chromecast");
    var r = new XMLHttpRequest();
    r.onload = function () {
        var d = JSON.parse(r.responseText);
        if (d.title == undefined) {
            t.text("今はキャストしていません");
        } else {
            if (d.app == "d anime store2") {
                d.app = "dアニメストア";
            }
            t.text(d.app + "「" + d.title + "」");
            $("#chromecast_fig").attr("src", d.images[0].url);
        }
    };
    r.onerror = function () {
        console.log("error");
    };

    r.open('GET', "/chromecast.cgi", true);
    r.send(null);
    
    $("#play").click(function () {
        $.get("/chromecast.cgi?play=1", null, null);
    });
    $("#pause").click(function () {
        $.get("/chromecast.cgi?pause=1", null, null);
    });
};

window.onload = function () {
    disk();
    chromecast();
};
</script>
</body>
</html>
